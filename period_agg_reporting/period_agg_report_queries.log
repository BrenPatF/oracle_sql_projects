
Database             Time                 Version
-------------------- -------------------- ------------------------------
Start: ORCL          09-NOV-2021 07:47:41 Version 21.3.0.0.0


Session altered.

Sales History Records with Running Sums

Product    Month          Value Value to Date     Cost Cost to Date
---------- ----------- -------- ------------- -------- ------------
PROD_ONE   01-Dec-2018    4,898         4,898      703          703
           01-Jan-2019    4,023         8,921      669        1,372
           01-Feb-2019    6,558        15,479      115        1,487
           01-Mar-2019    6,328        21,807      604        2,091
           01-Apr-2019    3,542        25,349      797        2,888
           01-May-2019    8,366        33,715      769        3,657
           01-Jun-2019    5,225        38,940      139        3,796
           01-Jul-2019    8,574        47,514      677        4,473
           01-Aug-2019    4,441        51,955      615        5,088
           01-Sep-2019    7,075        59,030      845        5,933
           01-Oct-2019    7,993        67,023      245        6,178
           01-Nov-2019    8,046        75,069      674        6,852
           01-Dec-2019    2,713        77,782      882        7,734
           01-Jan-2020    3,848        81,630      154        7,888
           01-Feb-2020    9,555        91,185      145        8,033
           01-Mar-2020    6,832        98,017      698        8,731
           01-Apr-2020    2,328       100,345      376        9,107
           01-May-2020    5,390       105,735      997       10,104
           01-Jun-2020    3,260       108,995      242       10,346
           01-Jul-2020    7,648       116,643      888       11,234
           01-Aug-2020    9,884       126,527      891       12,125
           01-Sep-2020    1,766       128,293      635       12,760
           01-Oct-2020    1,085       129,378      244       13,004
           01-Nov-2020    4,585       133,963      137       13,141
           01-Dec-2020    3,155       137,118      356       13,497
           01-Jan-2021    5,044       142,162      895       14,392
           01-Feb-2021    1,825       143,987      653       15,045
           01-Mar-2021    8,391       152,378      661       15,706
           01-Apr-2021    5,849       158,227      687       16,393
           01-May-2021    7,226       165,453      611       17,004
           01-Jun-2021    1,596       167,049      316       17,320
           01-Jul-2021    3,027       170,076      487       17,807
           01-Aug-2021    1,739       171,815      376       18,183
           01-Sep-2021    7,660       179,475      748       18,931
           01-Oct-2021    2,801       182,276      622       19,553
           01-Nov-2021    5,652       187,928      433       19,986
PROD_TWO   01-Dec-2018    5,056         5,056      784          784
           01-Jan-2019    4,806         9,862      808        1,592
           01-Feb-2019    3,891        13,753      263        1,855
           01-Mar-2019    7,114        20,867      487        2,342
           01-Apr-2019    2,376        23,243      789        3,131
           01-May-2019    9,486        32,729      138        3,269
           01-Jun-2019    6,982        39,711      522        3,791
           01-Jul-2019    3,594        43,305      718        4,509
           01-Aug-2019    9,636        52,941      262        4,771
           01-Sep-2019    6,085        59,026      386        5,157
           01-Oct-2019    4,576        63,602      967        6,124
           01-Nov-2019    3,750        67,352      162        6,286
           01-Dec-2019    2,665        70,017      843        7,129
           01-Jan-2020    3,837        73,854      289        7,418
           01-Feb-2020    7,662        81,516      924        8,342
           01-Mar-2020    4,697        86,213      721        9,063
           01-Apr-2020    1,402        87,615      885        9,948
           01-May-2020    7,024        94,639      472       10,420
           01-Jun-2020    8,165       102,804      550       10,970
           01-Jul-2020    1,479       104,283      722       11,692
           01-Aug-2020    4,764       109,047      671       12,363
           01-Sep-2020    6,494       115,541      758       13,121
           01-Oct-2020    7,382       122,923      562       13,683
           01-Nov-2020    2,048       124,971      137       13,820
           01-Dec-2020    5,371       130,342      375       14,195
           01-Jan-2021    1,341       131,683      638       14,833
           01-Feb-2021    5,896       137,579      840       15,673
           01-Mar-2021    4,948       142,527      672       16,345
           01-Apr-2021    6,268       148,795      764       17,109
           01-May-2021    9,963       158,758      155       17,264
           01-Jun-2021    1,868       160,626      181       17,445
           01-Jul-2021    2,079       162,705      278       17,723
           01-Aug-2021    6,743       169,448      651       18,374
           01-Sep-2021    5,097       174,545      515       18,889
           01-Oct-2021    9,727       184,272      407       19,296
           01-Nov-2021    4,402       188,674      440       19,736

72 rows selected.

  1  SELECT prod_code, month_dt, sales_value, Sum(sales_value) OVER (PARTITION BY prod_code ORDER BY month_dt) value_rsum,
  2       sales_cost, Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY month_dt) cost_rsum
  3    FROM sales_history
  4*  ORDER BY 1, 2
Periods Report by Union of Group Bys

Month       Product    Period             Value     Cost
----------- ---------- --------------- -------- --------
01-Dec-2018 PROD_ONE   P1 - 1 Month       4,898      703
                       P2 - 3 Months      4,898      703
                       P3 - YTD           4,898      703
                       P4 - 1 Year        4,898      703
            PROD_TWO   P1 - 1 Month       5,056      784
                       P2 - 3 Months      5,056      784
                       P3 - YTD           5,056      784
                       P4 - 1 Year        5,056      784
01-Jan-2019 PROD_ONE   P1 - 1 Month       4,023      669
                       P2 - 3 Months      8,921    1,372
                       P3 - YTD           4,023      669
                       P4 - 1 Year        8,921    1,372
            PROD_TWO   P1 - 1 Month       4,806      808
                       P2 - 3 Months      9,862    1,592
                       P3 - YTD           4,806      808
                       P4 - 1 Year        9,862    1,592
01-Feb-2019 PROD_ONE   P1 - 1 Month       6,558      115
                       P2 - 3 Months     15,479    1,487
                       P3 - YTD          10,581      784
                       P4 - 1 Year       15,479    1,487
            PROD_TWO   P1 - 1 Month       3,891      263
                       P2 - 3 Months     13,753    1,855
                       P3 - YTD           8,697    1,071
                       P4 - 1 Year       13,753    1,855
01-Mar-2019 PROD_ONE   P1 - 1 Month       6,328      604
                       P2 - 3 Months     16,909    1,388
                       P3 - YTD          16,909    1,388
                       P4 - 1 Year       21,807    2,091
            PROD_TWO   P1 - 1 Month       7,114      487
                       P2 - 3 Months     15,811    1,558
                       P3 - YTD          15,811    1,558
                       P4 - 1 Year       20,867    2,342
01-Apr-2019 PROD_ONE   P1 - 1 Month       3,542      797
                       P2 - 3 Months     16,428    1,516
                       P3 - YTD          20,451    2,185
                       P4 - 1 Year       25,349    2,888
            PROD_TWO   P1 - 1 Month       2,376      789
                       P2 - 3 Months     13,381    1,539
                       P3 - YTD          18,187    2,347
                       P4 - 1 Year       23,243    3,131
01-May-2019 PROD_ONE   P1 - 1 Month       8,366      769
                       P2 - 3 Months     18,236    2,170
                       P3 - YTD          28,817    2,954
                       P4 - 1 Year       33,715    3,657
            PROD_TWO   P1 - 1 Month       9,486      138
                       P2 - 3 Months     18,976    1,414
                       P3 - YTD          27,673    2,485
                       P4 - 1 Year       32,729    3,269
01-Jun-2019 PROD_ONE   P1 - 1 Month       5,225      139
                       P2 - 3 Months     17,133    1,705
                       P3 - YTD          34,042    3,093
                       P4 - 1 Year       38,940    3,796
            PROD_TWO   P1 - 1 Month       6,982      522
                       P2 - 3 Months     18,844    1,449
                       P3 - YTD          34,655    3,007
                       P4 - 1 Year       39,711    3,791
01-Jul-2019 PROD_ONE   P1 - 1 Month       8,574      677
                       P2 - 3 Months     22,165    1,585
                       P3 - YTD          42,616    3,770
                       P4 - 1 Year       47,514    4,473
            PROD_TWO   P1 - 1 Month       3,594      718
                       P2 - 3 Months     20,062    1,378
                       P3 - YTD          38,249    3,725
                       P4 - 1 Year       43,305    4,509
01-Aug-2019 PROD_ONE   P1 - 1 Month       4,441      615
                       P2 - 3 Months     18,240    1,431
                       P3 - YTD          47,057    4,385
                       P4 - 1 Year       51,955    5,088
            PROD_TWO   P1 - 1 Month       9,636      262
                       P2 - 3 Months     20,212    1,502
                       P3 - YTD          47,885    3,987
                       P4 - 1 Year       52,941    4,771
01-Sep-2019 PROD_ONE   P1 - 1 Month       7,075      845
                       P2 - 3 Months     20,090    2,137
                       P3 - YTD          54,132    5,230
                       P4 - 1 Year       59,030    5,933
            PROD_TWO   P1 - 1 Month       6,085      386
                       P2 - 3 Months     19,315    1,366
                       P3 - YTD          53,970    4,373
                       P4 - 1 Year       59,026    5,157
01-Oct-2019 PROD_ONE   P1 - 1 Month       7,993      245
                       P2 - 3 Months     19,509    1,705
                       P3 - YTD          62,125    5,475
                       P4 - 1 Year       67,023    6,178
            PROD_TWO   P1 - 1 Month       4,576      967
                       P2 - 3 Months     20,297    1,615
                       P3 - YTD          58,546    5,340
                       P4 - 1 Year       63,602    6,124
01-Nov-2019 PROD_ONE   P1 - 1 Month       8,046      674
                       P2 - 3 Months     23,114    1,764
                       P3 - YTD          70,171    6,149
                       P4 - 1 Year       75,069    6,852
            PROD_TWO   P1 - 1 Month       3,750      162
                       P2 - 3 Months     14,411    1,515
                       P3 - YTD          62,296    5,502
                       P4 - 1 Year       67,352    6,286
01-Dec-2019 PROD_ONE   P1 - 1 Month       2,713      882
                       P2 - 3 Months     18,752    1,801
                       P3 - YTD          72,884    7,031
                       P4 - 1 Year       72,884    7,031
            PROD_TWO   P1 - 1 Month       2,665      843
                       P2 - 3 Months     10,991    1,972
                       P3 - YTD          64,961    6,345
                       P4 - 1 Year       64,961    6,345
01-Jan-2020 PROD_ONE   P1 - 1 Month       3,848      154
                       P2 - 3 Months     14,607    1,710
                       P3 - YTD           3,848      154
                       P4 - 1 Year       72,709    6,516
            PROD_TWO   P1 - 1 Month       3,837      289
                       P2 - 3 Months     10,252    1,294
                       P3 - YTD           3,837      289
                       P4 - 1 Year       63,992    5,826
01-Feb-2020 PROD_ONE   P1 - 1 Month       9,555      145
                       P2 - 3 Months     16,116    1,181
                       P3 - YTD          13,403      299
                       P4 - 1 Year       75,706    6,546
            PROD_TWO   P1 - 1 Month       7,662      924
                       P2 - 3 Months     14,164    2,056
                       P3 - YTD          11,499    1,213
                       P4 - 1 Year       67,763    6,487
01-Mar-2020 PROD_ONE   P1 - 1 Month       6,832      698
                       P2 - 3 Months     20,235      997
                       P3 - YTD          20,235      997
                       P4 - 1 Year       76,210    6,640
            PROD_TWO   P1 - 1 Month       4,697      721
                       P2 - 3 Months     16,196    1,934
                       P3 - YTD          16,196    1,934
                       P4 - 1 Year       65,346    6,721
01-Apr-2020 PROD_ONE   P1 - 1 Month       2,328      376
                       P2 - 3 Months     18,715    1,219
                       P3 - YTD          22,563    1,373
                       P4 - 1 Year       74,996    6,219
            PROD_TWO   P1 - 1 Month       1,402      885
                       P2 - 3 Months     13,761    2,530
                       P3 - YTD          17,598    2,819
                       P4 - 1 Year       64,372    6,817
01-May-2020 PROD_ONE   P1 - 1 Month       5,390      997
                       P2 - 3 Months     14,550    2,071
                       P3 - YTD          27,953    2,370
                       P4 - 1 Year       72,020    6,447
            PROD_TWO   P1 - 1 Month       7,024      472
                       P2 - 3 Months     13,123    2,078
                       P3 - YTD          24,622    3,291
                       P4 - 1 Year       61,910    7,151
01-Jun-2020 PROD_ONE   P1 - 1 Month       3,260      242
                       P2 - 3 Months     10,978    1,615
                       P3 - YTD          31,213    2,612
                       P4 - 1 Year       70,055    6,550
            PROD_TWO   P1 - 1 Month       8,165      550
                       P2 - 3 Months     16,591    1,907
                       P3 - YTD          32,787    3,841
                       P4 - 1 Year       63,093    7,179
01-Jul-2020 PROD_ONE   P1 - 1 Month       7,648      888
                       P2 - 3 Months     16,298    2,127
                       P3 - YTD          38,861    3,500
                       P4 - 1 Year       69,129    6,761
            PROD_TWO   P1 - 1 Month       1,479      722
                       P2 - 3 Months     16,668    1,744
                       P3 - YTD          34,266    4,563
                       P4 - 1 Year       60,978    7,183
01-Aug-2020 PROD_ONE   P1 - 1 Month       9,884      891
                       P2 - 3 Months     20,792    2,021
                       P3 - YTD          48,745    4,391
                       P4 - 1 Year       74,572    7,037
            PROD_TWO   P1 - 1 Month       4,764      671
                       P2 - 3 Months     14,408    1,943
                       P3 - YTD          39,030    5,234
                       P4 - 1 Year       56,106    7,592
01-Sep-2020 PROD_ONE   P1 - 1 Month       1,766      635
                       P2 - 3 Months     19,298    2,414
                       P3 - YTD          50,511    5,026
                       P4 - 1 Year       69,263    6,827
            PROD_TWO   P1 - 1 Month       6,494      758
                       P2 - 3 Months     12,737    2,151
                       P3 - YTD          45,524    5,992
                       P4 - 1 Year       56,515    7,964
01-Oct-2020 PROD_ONE   P1 - 1 Month       1,085      244
                       P2 - 3 Months     12,735    1,770
                       P3 - YTD          51,596    5,270
                       P4 - 1 Year       62,355    6,826
            PROD_TWO   P1 - 1 Month       7,382      562
                       P2 - 3 Months     18,640    1,991
                       P3 - YTD          52,906    6,554
                       P4 - 1 Year       59,321    7,559
01-Nov-2020 PROD_ONE   P1 - 1 Month       4,585      137
                       P2 - 3 Months      7,436    1,016
                       P3 - YTD          56,181    5,407
                       P4 - 1 Year       58,894    6,289
            PROD_TWO   P1 - 1 Month       2,048      137
                       P2 - 3 Months     15,924    1,457
                       P3 - YTD          54,954    6,691
                       P4 - 1 Year       57,619    7,534
01-Dec-2020 PROD_ONE   P1 - 1 Month       3,155      356
                       P2 - 3 Months      8,825      737
                       P3 - YTD          59,336    5,763
                       P4 - 1 Year       59,336    5,763
            PROD_TWO   P1 - 1 Month       5,371      375
                       P2 - 3 Months     14,801    1,074
                       P3 - YTD          60,325    7,066
                       P4 - 1 Year       60,325    7,066
01-Jan-2021 PROD_ONE   P1 - 1 Month       5,044      895
                       P2 - 3 Months     12,784    1,388
                       P3 - YTD           5,044      895
                       P4 - 1 Year       60,532    6,504
            PROD_TWO   P1 - 1 Month       1,341      638
                       P2 - 3 Months      8,760    1,150
                       P3 - YTD           1,341      638
                       P4 - 1 Year       57,829    7,415
01-Feb-2021 PROD_ONE   P1 - 1 Month       1,825      653
                       P2 - 3 Months     10,024    1,904
                       P3 - YTD           6,869    1,548
                       P4 - 1 Year       52,802    7,012
            PROD_TWO   P1 - 1 Month       5,896      840
                       P2 - 3 Months     12,608    1,853
                       P3 - YTD           7,237    1,478
                       P4 - 1 Year       56,063    7,331
01-Mar-2021 PROD_ONE   P1 - 1 Month       8,391      661
                       P2 - 3 Months     15,260    2,209
                       P3 - YTD          15,260    2,209
                       P4 - 1 Year       54,361    6,975
            PROD_TWO   P1 - 1 Month       4,948      672
                       P2 - 3 Months     12,185    2,150
                       P3 - YTD          12,185    2,150
                       P4 - 1 Year       56,314    7,282
01-Apr-2021 PROD_ONE   P1 - 1 Month       5,849      687
                       P2 - 3 Months     16,065    2,001
                       P3 - YTD          21,109    2,896
                       P4 - 1 Year       57,882    7,286
            PROD_TWO   P1 - 1 Month       6,268      764
                       P2 - 3 Months     17,112    2,276
                       P3 - YTD          18,453    2,914
                       P4 - 1 Year       61,180    7,161
01-May-2021 PROD_ONE   P1 - 1 Month       7,226      611
                       P2 - 3 Months     21,466    1,959
                       P3 - YTD          28,335    3,507
                       P4 - 1 Year       59,718    6,900
            PROD_TWO   P1 - 1 Month       9,963      155
                       P2 - 3 Months     21,179    1,591
                       P3 - YTD          28,416    3,069
                       P4 - 1 Year       64,119    6,844
01-Jun-2021 PROD_ONE   P1 - 1 Month       1,596      316
                       P2 - 3 Months     14,671    1,614
                       P3 - YTD          29,931    3,823
                       P4 - 1 Year       58,054    6,974
            PROD_TWO   P1 - 1 Month       1,868      181
                       P2 - 3 Months     18,099    1,100
                       P3 - YTD          30,284    3,250
                       P4 - 1 Year       57,822    6,475
01-Jul-2021 PROD_ONE   P1 - 1 Month       3,027      487
                       P2 - 3 Months     11,849    1,414
                       P3 - YTD          32,958    4,310
                       P4 - 1 Year       53,433    6,573
            PROD_TWO   P1 - 1 Month       2,079      278
                       P2 - 3 Months     13,910      614
                       P3 - YTD          32,363    3,528
                       P4 - 1 Year       58,422    6,031
01-Aug-2021 PROD_ONE   P1 - 1 Month       1,739      376
                       P2 - 3 Months      6,362    1,179
                       P3 - YTD          34,697    4,686
                       P4 - 1 Year       45,288    6,058
            PROD_TWO   P1 - 1 Month       6,743      651
                       P2 - 3 Months     10,690    1,110
                       P3 - YTD          39,106    4,179
                       P4 - 1 Year       60,401    6,011
01-Sep-2021 PROD_ONE   P1 - 1 Month       7,660      748
                       P2 - 3 Months     12,426    1,611
                       P3 - YTD          42,357    5,434
                       P4 - 1 Year       51,182    6,171
            PROD_TWO   P1 - 1 Month       5,097      515
                       P2 - 3 Months     13,919    1,444
                       P3 - YTD          44,203    4,694
                       P4 - 1 Year       59,004    5,768
01-Oct-2021 PROD_ONE   P1 - 1 Month       2,801      622
                       P2 - 3 Months     12,200    1,746
                       P3 - YTD          45,158    6,056
                       P4 - 1 Year       52,898    6,549
            PROD_TWO   P1 - 1 Month       9,727      407
                       P2 - 3 Months     21,567    1,573
                       P3 - YTD          53,930    5,101
                       P4 - 1 Year       61,349    5,613
01-Nov-2021 PROD_ONE   P1 - 1 Month       5,652      433
                       P2 - 3 Months     16,113    1,803
                       P3 - YTD          50,810    6,489
                       P4 - 1 Year       53,965    6,845
            PROD_TWO   P1 - 1 Month       4,402      440
                       P2 - 3 Months     19,226    1,362
                       P3 - YTD          58,332    5,541
                       P4 - 1 Year       63,703    5,916

288 rows selected.

  1  SELECT /*+ gather_plan_statistics XPLAN_UGB */
  2       month_dt, prod_code, 'P1 - 1 Month' per_tp, sales_value, sales_cost
  3    FROM sales_history
  4   UNION ALL
  5  SELECT drv.month_dt, drv.prod_code, 'P2 - 3 Months', Sum(msr.sales_value), Sum(msr.sales_cost)
  6    FROM sales_history drv
  7    JOIN sales_history msr
  8    ON msr.prod_code = drv.prod_code
  9     AND msr.month_dt BETWEEN Add_Months (drv.month_dt, -2) AND drv.month_dt
 10   GROUP BY drv.prod_code, drv.month_dt
 11   UNION ALL
 12  SELECT drv.month_dt, drv.prod_code, 'P3 - YTD', Sum(msr.sales_value), Sum(msr.sales_cost)
 13    FROM sales_history drv
 14    JOIN sales_history msr
 15    ON msr.prod_code = drv.prod_code
 16     AND msr.month_dt BETWEEN Trunc(drv.month_dt, 'YEAR') AND drv.month_dt
 17   GROUP BY drv.prod_code, drv.month_dt
 18   UNION ALL
 19  SELECT drv.month_dt, drv.prod_code, 'P4 - 1 Year', Sum(msr.sales_value), Sum(msr.sales_cost)
 20    FROM sales_history drv
 21    JOIN sales_history msr
 22    ON msr.prod_code = drv.prod_code
 23     AND msr.month_dt BETWEEN Add_Months (drv.month_dt, -11) AND drv.month_dt
 24   GROUP BY drv.prod_code, drv.month_dt
 25*  ORDER BY 1, 2, 3
Report by Analytic Aggregation

Month       Product    Period             Value     Cost
----------- ---------- --------------- -------- --------
01-Dec-2018 PROD_ONE   P1 - 1 Month       4,898      703
                       P2 - 3 Months      4,898      703
                       P3 - YTD           4,898      703
                       P4 - 1 Year        4,898      703
            PROD_TWO   P1 - 1 Month       5,056      784
                       P2 - 3 Months      5,056      784
                       P3 - YTD           5,056      784
                       P4 - 1 Year        5,056      784
01-Jan-2019 PROD_ONE   P1 - 1 Month       4,023      669
                       P2 - 3 Months      8,921    1,372
                       P3 - YTD           4,023      669
                       P4 - 1 Year        8,921    1,372
            PROD_TWO   P1 - 1 Month       4,806      808
                       P2 - 3 Months      9,862    1,592
                       P3 - YTD           4,806      808
                       P4 - 1 Year        9,862    1,592
01-Feb-2019 PROD_ONE   P1 - 1 Month       6,558      115
                       P2 - 3 Months     15,479    1,487
                       P3 - YTD          10,581      784
                       P4 - 1 Year       15,479    1,487
            PROD_TWO   P1 - 1 Month       3,891      263
                       P2 - 3 Months     13,753    1,855
                       P3 - YTD           8,697    1,071
                       P4 - 1 Year       13,753    1,855
01-Mar-2019 PROD_ONE   P1 - 1 Month       6,328      604
                       P2 - 3 Months     16,909    1,388
                       P3 - YTD          16,909    1,388
                       P4 - 1 Year       21,807    2,091
            PROD_TWO   P1 - 1 Month       7,114      487
                       P2 - 3 Months     15,811    1,558
                       P3 - YTD          15,811    1,558
                       P4 - 1 Year       20,867    2,342
01-Apr-2019 PROD_ONE   P1 - 1 Month       3,542      797
                       P2 - 3 Months     16,428    1,516
                       P3 - YTD          20,451    2,185
                       P4 - 1 Year       25,349    2,888
            PROD_TWO   P1 - 1 Month       2,376      789
                       P2 - 3 Months     13,381    1,539
                       P3 - YTD          18,187    2,347
                       P4 - 1 Year       23,243    3,131
01-May-2019 PROD_ONE   P1 - 1 Month       8,366      769
                       P2 - 3 Months     18,236    2,170
                       P3 - YTD          28,817    2,954
                       P4 - 1 Year       33,715    3,657
            PROD_TWO   P1 - 1 Month       9,486      138
                       P2 - 3 Months     18,976    1,414
                       P3 - YTD          27,673    2,485
                       P4 - 1 Year       32,729    3,269
01-Jun-2019 PROD_ONE   P1 - 1 Month       5,225      139
                       P2 - 3 Months     17,133    1,705
                       P3 - YTD          34,042    3,093
                       P4 - 1 Year       38,940    3,796
            PROD_TWO   P1 - 1 Month       6,982      522
                       P2 - 3 Months     18,844    1,449
                       P3 - YTD          34,655    3,007
                       P4 - 1 Year       39,711    3,791
01-Jul-2019 PROD_ONE   P1 - 1 Month       8,574      677
                       P2 - 3 Months     22,165    1,585
                       P3 - YTD          42,616    3,770
                       P4 - 1 Year       47,514    4,473
            PROD_TWO   P1 - 1 Month       3,594      718
                       P2 - 3 Months     20,062    1,378
                       P3 - YTD          38,249    3,725
                       P4 - 1 Year       43,305    4,509
01-Aug-2019 PROD_ONE   P1 - 1 Month       4,441      615
                       P2 - 3 Months     18,240    1,431
                       P3 - YTD          47,057    4,385
                       P4 - 1 Year       51,955    5,088
            PROD_TWO   P1 - 1 Month       9,636      262
                       P2 - 3 Months     20,212    1,502
                       P3 - YTD          47,885    3,987
                       P4 - 1 Year       52,941    4,771
01-Sep-2019 PROD_ONE   P1 - 1 Month       7,075      845
                       P2 - 3 Months     20,090    2,137
                       P3 - YTD          54,132    5,230
                       P4 - 1 Year       59,030    5,933
            PROD_TWO   P1 - 1 Month       6,085      386
                       P2 - 3 Months     19,315    1,366
                       P3 - YTD          53,970    4,373
                       P4 - 1 Year       59,026    5,157
01-Oct-2019 PROD_ONE   P1 - 1 Month       7,993      245
                       P2 - 3 Months     19,509    1,705
                       P3 - YTD          62,125    5,475
                       P4 - 1 Year       67,023    6,178
            PROD_TWO   P1 - 1 Month       4,576      967
                       P2 - 3 Months     20,297    1,615
                       P3 - YTD          58,546    5,340
                       P4 - 1 Year       63,602    6,124
01-Nov-2019 PROD_ONE   P1 - 1 Month       8,046      674
                       P2 - 3 Months     23,114    1,764
                       P3 - YTD          70,171    6,149
                       P4 - 1 Year       75,069    6,852
            PROD_TWO   P1 - 1 Month       3,750      162
                       P2 - 3 Months     14,411    1,515
                       P3 - YTD          62,296    5,502
                       P4 - 1 Year       67,352    6,286
01-Dec-2019 PROD_ONE   P1 - 1 Month       2,713      882
                       P2 - 3 Months     18,752    1,801
                       P3 - YTD          72,884    7,031
                       P4 - 1 Year       72,884    7,031
            PROD_TWO   P1 - 1 Month       2,665      843
                       P2 - 3 Months     10,991    1,972
                       P3 - YTD          64,961    6,345
                       P4 - 1 Year       64,961    6,345
01-Jan-2020 PROD_ONE   P1 - 1 Month       3,848      154
                       P2 - 3 Months     14,607    1,710
                       P3 - YTD           3,848      154
                       P4 - 1 Year       72,709    6,516
            PROD_TWO   P1 - 1 Month       3,837      289
                       P2 - 3 Months     10,252    1,294
                       P3 - YTD           3,837      289
                       P4 - 1 Year       63,992    5,826
01-Feb-2020 PROD_ONE   P1 - 1 Month       9,555      145
                       P2 - 3 Months     16,116    1,181
                       P3 - YTD          13,403      299
                       P4 - 1 Year       75,706    6,546
            PROD_TWO   P1 - 1 Month       7,662      924
                       P2 - 3 Months     14,164    2,056
                       P3 - YTD          11,499    1,213
                       P4 - 1 Year       67,763    6,487
01-Mar-2020 PROD_ONE   P1 - 1 Month       6,832      698
                       P2 - 3 Months     20,235      997
                       P3 - YTD          20,235      997
                       P4 - 1 Year       76,210    6,640
            PROD_TWO   P1 - 1 Month       4,697      721
                       P2 - 3 Months     16,196    1,934
                       P3 - YTD          16,196    1,934
                       P4 - 1 Year       65,346    6,721
01-Apr-2020 PROD_ONE   P1 - 1 Month       2,328      376
                       P2 - 3 Months     18,715    1,219
                       P3 - YTD          22,563    1,373
                       P4 - 1 Year       74,996    6,219
            PROD_TWO   P1 - 1 Month       1,402      885
                       P2 - 3 Months     13,761    2,530
                       P3 - YTD          17,598    2,819
                       P4 - 1 Year       64,372    6,817
01-May-2020 PROD_ONE   P1 - 1 Month       5,390      997
                       P2 - 3 Months     14,550    2,071
                       P3 - YTD          27,953    2,370
                       P4 - 1 Year       72,020    6,447
            PROD_TWO   P1 - 1 Month       7,024      472
                       P2 - 3 Months     13,123    2,078
                       P3 - YTD          24,622    3,291
                       P4 - 1 Year       61,910    7,151
01-Jun-2020 PROD_ONE   P1 - 1 Month       3,260      242
                       P2 - 3 Months     10,978    1,615
                       P3 - YTD          31,213    2,612
                       P4 - 1 Year       70,055    6,550
            PROD_TWO   P1 - 1 Month       8,165      550
                       P2 - 3 Months     16,591    1,907
                       P3 - YTD          32,787    3,841
                       P4 - 1 Year       63,093    7,179
01-Jul-2020 PROD_ONE   P1 - 1 Month       7,648      888
                       P2 - 3 Months     16,298    2,127
                       P3 - YTD          38,861    3,500
                       P4 - 1 Year       69,129    6,761
            PROD_TWO   P1 - 1 Month       1,479      722
                       P2 - 3 Months     16,668    1,744
                       P3 - YTD          34,266    4,563
                       P4 - 1 Year       60,978    7,183
01-Aug-2020 PROD_ONE   P1 - 1 Month       9,884      891
                       P2 - 3 Months     20,792    2,021
                       P3 - YTD          48,745    4,391
                       P4 - 1 Year       74,572    7,037
            PROD_TWO   P1 - 1 Month       4,764      671
                       P2 - 3 Months     14,408    1,943
                       P3 - YTD          39,030    5,234
                       P4 - 1 Year       56,106    7,592
01-Sep-2020 PROD_ONE   P1 - 1 Month       1,766      635
                       P2 - 3 Months     19,298    2,414
                       P3 - YTD          50,511    5,026
                       P4 - 1 Year       69,263    6,827
            PROD_TWO   P1 - 1 Month       6,494      758
                       P2 - 3 Months     12,737    2,151
                       P3 - YTD          45,524    5,992
                       P4 - 1 Year       56,515    7,964
01-Oct-2020 PROD_ONE   P1 - 1 Month       1,085      244
                       P2 - 3 Months     12,735    1,770
                       P3 - YTD          51,596    5,270
                       P4 - 1 Year       62,355    6,826
            PROD_TWO   P1 - 1 Month       7,382      562
                       P2 - 3 Months     18,640    1,991
                       P3 - YTD          52,906    6,554
                       P4 - 1 Year       59,321    7,559
01-Nov-2020 PROD_ONE   P1 - 1 Month       4,585      137
                       P2 - 3 Months      7,436    1,016
                       P3 - YTD          56,181    5,407
                       P4 - 1 Year       58,894    6,289
            PROD_TWO   P1 - 1 Month       2,048      137
                       P2 - 3 Months     15,924    1,457
                       P3 - YTD          54,954    6,691
                       P4 - 1 Year       57,619    7,534
01-Dec-2020 PROD_ONE   P1 - 1 Month       3,155      356
                       P2 - 3 Months      8,825      737
                       P3 - YTD          59,336    5,763
                       P4 - 1 Year       59,336    5,763
            PROD_TWO   P1 - 1 Month       5,371      375
                       P2 - 3 Months     14,801    1,074
                       P3 - YTD          60,325    7,066
                       P4 - 1 Year       60,325    7,066
01-Jan-2021 PROD_ONE   P1 - 1 Month       5,044      895
                       P2 - 3 Months     12,784    1,388
                       P3 - YTD           5,044      895
                       P4 - 1 Year       60,532    6,504
            PROD_TWO   P1 - 1 Month       1,341      638
                       P2 - 3 Months      8,760    1,150
                       P3 - YTD           1,341      638
                       P4 - 1 Year       57,829    7,415
01-Feb-2021 PROD_ONE   P1 - 1 Month       1,825      653
                       P2 - 3 Months     10,024    1,904
                       P3 - YTD           6,869    1,548
                       P4 - 1 Year       52,802    7,012
            PROD_TWO   P1 - 1 Month       5,896      840
                       P2 - 3 Months     12,608    1,853
                       P3 - YTD           7,237    1,478
                       P4 - 1 Year       56,063    7,331
01-Mar-2021 PROD_ONE   P1 - 1 Month       8,391      661
                       P2 - 3 Months     15,260    2,209
                       P3 - YTD          15,260    2,209
                       P4 - 1 Year       54,361    6,975
            PROD_TWO   P1 - 1 Month       4,948      672
                       P2 - 3 Months     12,185    2,150
                       P3 - YTD          12,185    2,150
                       P4 - 1 Year       56,314    7,282
01-Apr-2021 PROD_ONE   P1 - 1 Month       5,849      687
                       P2 - 3 Months     16,065    2,001
                       P3 - YTD          21,109    2,896
                       P4 - 1 Year       57,882    7,286
            PROD_TWO   P1 - 1 Month       6,268      764
                       P2 - 3 Months     17,112    2,276
                       P3 - YTD          18,453    2,914
                       P4 - 1 Year       61,180    7,161
01-May-2021 PROD_ONE   P1 - 1 Month       7,226      611
                       P2 - 3 Months     21,466    1,959
                       P3 - YTD          28,335    3,507
                       P4 - 1 Year       59,718    6,900
            PROD_TWO   P1 - 1 Month       9,963      155
                       P2 - 3 Months     21,179    1,591
                       P3 - YTD          28,416    3,069
                       P4 - 1 Year       64,119    6,844
01-Jun-2021 PROD_ONE   P1 - 1 Month       1,596      316
                       P2 - 3 Months     14,671    1,614
                       P3 - YTD          29,931    3,823
                       P4 - 1 Year       58,054    6,974
            PROD_TWO   P1 - 1 Month       1,868      181
                       P2 - 3 Months     18,099    1,100
                       P3 - YTD          30,284    3,250
                       P4 - 1 Year       57,822    6,475
01-Jul-2021 PROD_ONE   P1 - 1 Month       3,027      487
                       P2 - 3 Months     11,849    1,414
                       P3 - YTD          32,958    4,310
                       P4 - 1 Year       53,433    6,573
            PROD_TWO   P1 - 1 Month       2,079      278
                       P2 - 3 Months     13,910      614
                       P3 - YTD          32,363    3,528
                       P4 - 1 Year       58,422    6,031
01-Aug-2021 PROD_ONE   P1 - 1 Month       1,739      376
                       P2 - 3 Months      6,362    1,179
                       P3 - YTD          34,697    4,686
                       P4 - 1 Year       45,288    6,058
            PROD_TWO   P1 - 1 Month       6,743      651
                       P2 - 3 Months     10,690    1,110
                       P3 - YTD          39,106    4,179
                       P4 - 1 Year       60,401    6,011
01-Sep-2021 PROD_ONE   P1 - 1 Month       7,660      748
                       P2 - 3 Months     12,426    1,611
                       P3 - YTD          42,357    5,434
                       P4 - 1 Year       51,182    6,171
            PROD_TWO   P1 - 1 Month       5,097      515
                       P2 - 3 Months     13,919    1,444
                       P3 - YTD          44,203    4,694
                       P4 - 1 Year       59,004    5,768
01-Oct-2021 PROD_ONE   P1 - 1 Month       2,801      622
                       P2 - 3 Months     12,200    1,746
                       P3 - YTD          45,158    6,056
                       P4 - 1 Year       52,898    6,549
            PROD_TWO   P1 - 1 Month       9,727      407
                       P2 - 3 Months     21,567    1,573
                       P3 - YTD          53,930    5,101
                       P4 - 1 Year       61,349    5,613
01-Nov-2021 PROD_ONE   P1 - 1 Month       5,652      433
                       P2 - 3 Months     16,113    1,803
                       P3 - YTD          50,810    6,489
                       P4 - 1 Year       53,965    6,845
            PROD_TWO   P1 - 1 Month       4,402      440
                       P2 - 3 Months     19,226    1,362
                       P3 - YTD          58,332    5,541
                       P4 - 1 Year       63,703    5,916

288 rows selected.

  1  WITH period_aggs AS (
  2    SELECT /*+ gather_plan_statistics XPLAN_AAG */
  3         month_dt, prod_code, sales_value,
  4         Sum(sales_value) OVER (PARTITION BY prod_code ORDER BY month_dt
  5                    RANGE BETWEEN INTERVAL '2' MONTH PRECEDING AND CURRENT ROW)     sales_value_3m,
  6         Sum(sales_value) OVER (PARTITION BY prod_code, Trunc(month_dt, 'YEAR') ORDER BY month_dt
  7                    RANGE BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)     sales_value_ytd,
  8         Sum(sales_value) OVER (PARTITION BY prod_code ORDER BY month_dt
  9                    RANGE BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)     sales_value_1y,
 10         sales_cost,
 11         Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY month_dt
 12                    RANGE BETWEEN INTERVAL '2' MONTH PRECEDING AND CURRENT ROW)     sales_cost_3m,
 13         Sum(sales_cost) OVER (PARTITION BY prod_code, Trunc(month_dt, 'YEAR') ORDER BY month_dt
 14                    RANGE BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)     sales_cost_ytd,
 15         Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY month_dt
 16                    RANGE BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)     sales_cost_1y
 17      FROM sales_history
 18  )
 19  SELECT *
 20    FROM period_aggs
 21  UNPIVOT (
 22      (sales_value, sales_cost)
 23      FOR per_tp IN (
 24        (sales_value, sales_cost)       AS 'P1 - 1 Month',
 25        (sales_value_3m, sales_cost_3m)   AS 'P2 - 3 Months',
 26        (sales_value_ytd, sales_cost_ytd)   AS 'P3 - YTD',
 27        (sales_value_1y, sales_cost_1y)   AS 'P4 - 1 Year'
 28      )
 29  )
 30*  ORDER BY 1, 2, 3
Report by Single Group By with CASE Expressions

Month       Product    Period             Value     Cost
----------- ---------- --------------- -------- --------
01-Dec-2018 PROD_ONE   P1 - 1 Month       4,898      703
                       P2 - 3 Months      4,898      703
                       P3 - YTD           4,898      703
                       P4 - 1 Year        4,898      703
            PROD_TWO   P1 - 1 Month       5,056      784
                       P2 - 3 Months      5,056      784
                       P3 - YTD           5,056      784
                       P4 - 1 Year        5,056      784
01-Jan-2019 PROD_ONE   P1 - 1 Month       4,023      669
                       P2 - 3 Months      8,921    1,372
                       P3 - YTD           4,023      669
                       P4 - 1 Year        8,921    1,372
            PROD_TWO   P1 - 1 Month       4,806      808
                       P2 - 3 Months      9,862    1,592
                       P3 - YTD           4,806      808
                       P4 - 1 Year        9,862    1,592
01-Feb-2019 PROD_ONE   P1 - 1 Month       6,558      115
                       P2 - 3 Months     15,479    1,487
                       P3 - YTD          10,581      784
                       P4 - 1 Year       15,479    1,487
            PROD_TWO   P1 - 1 Month       3,891      263
                       P2 - 3 Months     13,753    1,855
                       P3 - YTD           8,697    1,071
                       P4 - 1 Year       13,753    1,855
01-Mar-2019 PROD_ONE   P1 - 1 Month       6,328      604
                       P2 - 3 Months     16,909    1,388
                       P3 - YTD          16,909    1,388
                       P4 - 1 Year       21,807    2,091
            PROD_TWO   P1 - 1 Month       7,114      487
                       P2 - 3 Months     15,811    1,558
                       P3 - YTD          15,811    1,558
                       P4 - 1 Year       20,867    2,342
01-Apr-2019 PROD_ONE   P1 - 1 Month       3,542      797
                       P2 - 3 Months     16,428    1,516
                       P3 - YTD          20,451    2,185
                       P4 - 1 Year       25,349    2,888
            PROD_TWO   P1 - 1 Month       2,376      789
                       P2 - 3 Months     13,381    1,539
                       P3 - YTD          18,187    2,347
                       P4 - 1 Year       23,243    3,131
01-May-2019 PROD_ONE   P1 - 1 Month       8,366      769
                       P2 - 3 Months     18,236    2,170
                       P3 - YTD          28,817    2,954
                       P4 - 1 Year       33,715    3,657
            PROD_TWO   P1 - 1 Month       9,486      138
                       P2 - 3 Months     18,976    1,414
                       P3 - YTD          27,673    2,485
                       P4 - 1 Year       32,729    3,269
01-Jun-2019 PROD_ONE   P1 - 1 Month       5,225      139
                       P2 - 3 Months     17,133    1,705
                       P3 - YTD          34,042    3,093
                       P4 - 1 Year       38,940    3,796
            PROD_TWO   P1 - 1 Month       6,982      522
                       P2 - 3 Months     18,844    1,449
                       P3 - YTD          34,655    3,007
                       P4 - 1 Year       39,711    3,791
01-Jul-2019 PROD_ONE   P1 - 1 Month       8,574      677
                       P2 - 3 Months     22,165    1,585
                       P3 - YTD          42,616    3,770
                       P4 - 1 Year       47,514    4,473
            PROD_TWO   P1 - 1 Month       3,594      718
                       P2 - 3 Months     20,062    1,378
                       P3 - YTD          38,249    3,725
                       P4 - 1 Year       43,305    4,509
01-Aug-2019 PROD_ONE   P1 - 1 Month       4,441      615
                       P2 - 3 Months     18,240    1,431
                       P3 - YTD          47,057    4,385
                       P4 - 1 Year       51,955    5,088
            PROD_TWO   P1 - 1 Month       9,636      262
                       P2 - 3 Months     20,212    1,502
                       P3 - YTD          47,885    3,987
                       P4 - 1 Year       52,941    4,771
01-Sep-2019 PROD_ONE   P1 - 1 Month       7,075      845
                       P2 - 3 Months     20,090    2,137
                       P3 - YTD          54,132    5,230
                       P4 - 1 Year       59,030    5,933
            PROD_TWO   P1 - 1 Month       6,085      386
                       P2 - 3 Months     19,315    1,366
                       P3 - YTD          53,970    4,373
                       P4 - 1 Year       59,026    5,157
01-Oct-2019 PROD_ONE   P1 - 1 Month       7,993      245
                       P2 - 3 Months     19,509    1,705
                       P3 - YTD          62,125    5,475
                       P4 - 1 Year       67,023    6,178
            PROD_TWO   P1 - 1 Month       4,576      967
                       P2 - 3 Months     20,297    1,615
                       P3 - YTD          58,546    5,340
                       P4 - 1 Year       63,602    6,124
01-Nov-2019 PROD_ONE   P1 - 1 Month       8,046      674
                       P2 - 3 Months     23,114    1,764
                       P3 - YTD          70,171    6,149
                       P4 - 1 Year       75,069    6,852
            PROD_TWO   P1 - 1 Month       3,750      162
                       P2 - 3 Months     14,411    1,515
                       P3 - YTD          62,296    5,502
                       P4 - 1 Year       67,352    6,286
01-Dec-2019 PROD_ONE   P1 - 1 Month       2,713      882
                       P2 - 3 Months     18,752    1,801
                       P3 - YTD          72,884    7,031
                       P4 - 1 Year       72,884    7,031
            PROD_TWO   P1 - 1 Month       2,665      843
                       P2 - 3 Months     10,991    1,972
                       P3 - YTD          64,961    6,345
                       P4 - 1 Year       64,961    6,345
01-Jan-2020 PROD_ONE   P1 - 1 Month       3,848      154
                       P2 - 3 Months     14,607    1,710
                       P3 - YTD           3,848      154
                       P4 - 1 Year       72,709    6,516
            PROD_TWO   P1 - 1 Month       3,837      289
                       P2 - 3 Months     10,252    1,294
                       P3 - YTD           3,837      289
                       P4 - 1 Year       63,992    5,826
01-Feb-2020 PROD_ONE   P1 - 1 Month       9,555      145
                       P2 - 3 Months     16,116    1,181
                       P3 - YTD          13,403      299
                       P4 - 1 Year       75,706    6,546
            PROD_TWO   P1 - 1 Month       7,662      924
                       P2 - 3 Months     14,164    2,056
                       P3 - YTD          11,499    1,213
                       P4 - 1 Year       67,763    6,487
01-Mar-2020 PROD_ONE   P1 - 1 Month       6,832      698
                       P2 - 3 Months     20,235      997
                       P3 - YTD          20,235      997
                       P4 - 1 Year       76,210    6,640
            PROD_TWO   P1 - 1 Month       4,697      721
                       P2 - 3 Months     16,196    1,934
                       P3 - YTD          16,196    1,934
                       P4 - 1 Year       65,346    6,721
01-Apr-2020 PROD_ONE   P1 - 1 Month       2,328      376
                       P2 - 3 Months     18,715    1,219
                       P3 - YTD          22,563    1,373
                       P4 - 1 Year       74,996    6,219
            PROD_TWO   P1 - 1 Month       1,402      885
                       P2 - 3 Months     13,761    2,530
                       P3 - YTD          17,598    2,819
                       P4 - 1 Year       64,372    6,817
01-May-2020 PROD_ONE   P1 - 1 Month       5,390      997
                       P2 - 3 Months     14,550    2,071
                       P3 - YTD          27,953    2,370
                       P4 - 1 Year       72,020    6,447
            PROD_TWO   P1 - 1 Month       7,024      472
                       P2 - 3 Months     13,123    2,078
                       P3 - YTD          24,622    3,291
                       P4 - 1 Year       61,910    7,151
01-Jun-2020 PROD_ONE   P1 - 1 Month       3,260      242
                       P2 - 3 Months     10,978    1,615
                       P3 - YTD          31,213    2,612
                       P4 - 1 Year       70,055    6,550
            PROD_TWO   P1 - 1 Month       8,165      550
                       P2 - 3 Months     16,591    1,907
                       P3 - YTD          32,787    3,841
                       P4 - 1 Year       63,093    7,179
01-Jul-2020 PROD_ONE   P1 - 1 Month       7,648      888
                       P2 - 3 Months     16,298    2,127
                       P3 - YTD          38,861    3,500
                       P4 - 1 Year       69,129    6,761
            PROD_TWO   P1 - 1 Month       1,479      722
                       P2 - 3 Months     16,668    1,744
                       P3 - YTD          34,266    4,563
                       P4 - 1 Year       60,978    7,183
01-Aug-2020 PROD_ONE   P1 - 1 Month       9,884      891
                       P2 - 3 Months     20,792    2,021
                       P3 - YTD          48,745    4,391
                       P4 - 1 Year       74,572    7,037
            PROD_TWO   P1 - 1 Month       4,764      671
                       P2 - 3 Months     14,408    1,943
                       P3 - YTD          39,030    5,234
                       P4 - 1 Year       56,106    7,592
01-Sep-2020 PROD_ONE   P1 - 1 Month       1,766      635
                       P2 - 3 Months     19,298    2,414
                       P3 - YTD          50,511    5,026
                       P4 - 1 Year       69,263    6,827
            PROD_TWO   P1 - 1 Month       6,494      758
                       P2 - 3 Months     12,737    2,151
                       P3 - YTD          45,524    5,992
                       P4 - 1 Year       56,515    7,964
01-Oct-2020 PROD_ONE   P1 - 1 Month       1,085      244
                       P2 - 3 Months     12,735    1,770
                       P3 - YTD          51,596    5,270
                       P4 - 1 Year       62,355    6,826
            PROD_TWO   P1 - 1 Month       7,382      562
                       P2 - 3 Months     18,640    1,991
                       P3 - YTD          52,906    6,554
                       P4 - 1 Year       59,321    7,559
01-Nov-2020 PROD_ONE   P1 - 1 Month       4,585      137
                       P2 - 3 Months      7,436    1,016
                       P3 - YTD          56,181    5,407
                       P4 - 1 Year       58,894    6,289
            PROD_TWO   P1 - 1 Month       2,048      137
                       P2 - 3 Months     15,924    1,457
                       P3 - YTD          54,954    6,691
                       P4 - 1 Year       57,619    7,534
01-Dec-2020 PROD_ONE   P1 - 1 Month       3,155      356
                       P2 - 3 Months      8,825      737
                       P3 - YTD          59,336    5,763
                       P4 - 1 Year       59,336    5,763
            PROD_TWO   P1 - 1 Month       5,371      375
                       P2 - 3 Months     14,801    1,074
                       P3 - YTD          60,325    7,066
                       P4 - 1 Year       60,325    7,066
01-Jan-2021 PROD_ONE   P1 - 1 Month       5,044      895
                       P2 - 3 Months     12,784    1,388
                       P3 - YTD           5,044      895
                       P4 - 1 Year       60,532    6,504
            PROD_TWO   P1 - 1 Month       1,341      638
                       P2 - 3 Months      8,760    1,150
                       P3 - YTD           1,341      638
                       P4 - 1 Year       57,829    7,415
01-Feb-2021 PROD_ONE   P1 - 1 Month       1,825      653
                       P2 - 3 Months     10,024    1,904
                       P3 - YTD           6,869    1,548
                       P4 - 1 Year       52,802    7,012
            PROD_TWO   P1 - 1 Month       5,896      840
                       P2 - 3 Months     12,608    1,853
                       P3 - YTD           7,237    1,478
                       P4 - 1 Year       56,063    7,331
01-Mar-2021 PROD_ONE   P1 - 1 Month       8,391      661
                       P2 - 3 Months     15,260    2,209
                       P3 - YTD          15,260    2,209
                       P4 - 1 Year       54,361    6,975
            PROD_TWO   P1 - 1 Month       4,948      672
                       P2 - 3 Months     12,185    2,150
                       P3 - YTD          12,185    2,150
                       P4 - 1 Year       56,314    7,282
01-Apr-2021 PROD_ONE   P1 - 1 Month       5,849      687
                       P2 - 3 Months     16,065    2,001
                       P3 - YTD          21,109    2,896
                       P4 - 1 Year       57,882    7,286
            PROD_TWO   P1 - 1 Month       6,268      764
                       P2 - 3 Months     17,112    2,276
                       P3 - YTD          18,453    2,914
                       P4 - 1 Year       61,180    7,161
01-May-2021 PROD_ONE   P1 - 1 Month       7,226      611
                       P2 - 3 Months     21,466    1,959
                       P3 - YTD          28,335    3,507
                       P4 - 1 Year       59,718    6,900
            PROD_TWO   P1 - 1 Month       9,963      155
                       P2 - 3 Months     21,179    1,591
                       P3 - YTD          28,416    3,069
                       P4 - 1 Year       64,119    6,844
01-Jun-2021 PROD_ONE   P1 - 1 Month       1,596      316
                       P2 - 3 Months     14,671    1,614
                       P3 - YTD          29,931    3,823
                       P4 - 1 Year       58,054    6,974
            PROD_TWO   P1 - 1 Month       1,868      181
                       P2 - 3 Months     18,099    1,100
                       P3 - YTD          30,284    3,250
                       P4 - 1 Year       57,822    6,475
01-Jul-2021 PROD_ONE   P1 - 1 Month       3,027      487
                       P2 - 3 Months     11,849    1,414
                       P3 - YTD          32,958    4,310
                       P4 - 1 Year       53,433    6,573
            PROD_TWO   P1 - 1 Month       2,079      278
                       P2 - 3 Months     13,910      614
                       P3 - YTD          32,363    3,528
                       P4 - 1 Year       58,422    6,031
01-Aug-2021 PROD_ONE   P1 - 1 Month       1,739      376
                       P2 - 3 Months      6,362    1,179
                       P3 - YTD          34,697    4,686
                       P4 - 1 Year       45,288    6,058
            PROD_TWO   P1 - 1 Month       6,743      651
                       P2 - 3 Months     10,690    1,110
                       P3 - YTD          39,106    4,179
                       P4 - 1 Year       60,401    6,011
01-Sep-2021 PROD_ONE   P1 - 1 Month       7,660      748
                       P2 - 3 Months     12,426    1,611
                       P3 - YTD          42,357    5,434
                       P4 - 1 Year       51,182    6,171
            PROD_TWO   P1 - 1 Month       5,097      515
                       P2 - 3 Months     13,919    1,444
                       P3 - YTD          44,203    4,694
                       P4 - 1 Year       59,004    5,768
01-Oct-2021 PROD_ONE   P1 - 1 Month       2,801      622
                       P2 - 3 Months     12,200    1,746
                       P3 - YTD          45,158    6,056
                       P4 - 1 Year       52,898    6,549
            PROD_TWO   P1 - 1 Month       9,727      407
                       P2 - 3 Months     21,567    1,573
                       P3 - YTD          53,930    5,101
                       P4 - 1 Year       61,349    5,613
01-Nov-2021 PROD_ONE   P1 - 1 Month       5,652      433
                       P2 - 3 Months     16,113    1,803
                       P3 - YTD          50,810    6,489
                       P4 - 1 Year       53,965    6,845
            PROD_TWO   P1 - 1 Month       4,402      440
                       P2 - 3 Months     19,226    1,362
                       P3 - YTD          58,332    5,541
                       P4 - 1 Year       63,703    5,916

288 rows selected.

  1  WITH period_list AS (
  2    SELECT month_dt, prod_code, COLUMN_VALUE per_tp
  3      FROM TABLE(SYS.ODCIVarchar2List(
  4            'P1 - 1 Month',
  5            'P2 - 3 Months',
  6            'P3 - YTD',
  7            'P4 - 1 Year')
  8        )
  9    CROSS JOIN (SELECT month_dt, prod_code FROM sales_history)
 10  )
 11  SELECT /*+ gather_plan_statistics XPLAN_GBC */
 12         drv.month_dt, drv.prod_code, drv.per_tp,
 13         Sum( CASE WHEN ( per_tp = 'P1 - 1 Month'  AND msr.month_dt = drv.month_dt ) OR
 14                        ( per_tp = 'P2 - 3 Months' AND msr.month_dt >= Add_Months (drv.month_dt, -2) ) OR
 15                        ( per_tp = 'P3 - YTD'      AND Trunc (msr.month_dt, 'YEAR') = Trunc (drv.month_dt, 'YEAR') ) OR
 16                        ( per_tp = 'P4 - 1 Year'   AND msr.month_dt >= Add_Months (drv.month_dt, -11) )
 17                   THEN msr.sales_value END) sales_value,
 18         Sum( CASE WHEN ( per_tp = 'P1 - 1 Month'  AND msr.month_dt = drv.month_dt ) OR
 19                        ( per_tp = 'P2 - 3 Months' AND msr.month_dt >= Add_Months (drv.month_dt, -2) ) OR
 20                        ( per_tp = 'P3 - YTD'      AND Trunc (msr.month_dt, 'YEAR') = Trunc (drv.month_dt, 'YEAR') ) OR
 21                        ( per_tp = 'P4 - 1 Year'   AND msr.month_dt >= Add_Months (drv.month_dt, -11) )
 22                   THEN msr.sales_cost END) sales_cost
 23    FROM period_list drv
 24    JOIN sales_history msr
 25    ON msr.prod_code = drv.prod_code
 26     AND msr.month_dt <= drv.month_dt
 27   GROUP BY drv.prod_code, drv.month_dt, drv.per_tp
 28*  ORDER BY 1, 2, 3
Report by Analytic Aggregation in pipelined function

Month       Product    Period             Value     Cost
----------- ---------- --------------- -------- --------
01-Dec-2018 PROD_ONE   P1 - cur           4,898      703
                       P2 - 3m            4,898      703
                       P3 - ytd           4,898      703
                       P4 - 1y            4,898      703
            PROD_TWO   P1 - cur           5,056      784
                       P2 - 3m            5,056      784
                       P3 - ytd           5,056      784
                       P4 - 1y            5,056      784
01-Jan-2019 PROD_ONE   P1 - cur           4,023      669
                       P2 - 3m            8,921    1,372
                       P3 - ytd          72,884    7,031
                       P4 - 1y            8,921    1,372
            PROD_TWO   P1 - cur           4,806      808
                       P2 - 3m            9,862    1,592
                       P3 - ytd          64,961    6,345
                       P4 - 1y            9,862    1,592
01-Feb-2019 PROD_ONE   P1 - cur           6,558      115
                       P2 - 3m           15,479    1,487
                       P3 - ytd          72,884    7,031
                       P4 - 1y           15,479    1,487
            PROD_TWO   P1 - cur           3,891      263
                       P2 - 3m           13,753    1,855
                       P3 - ytd          64,961    6,345
                       P4 - 1y           13,753    1,855
01-Mar-2019 PROD_ONE   P1 - cur           6,328      604
                       P2 - 3m           16,909    1,388
                       P3 - ytd          72,884    7,031
                       P4 - 1y           21,807    2,091
            PROD_TWO   P1 - cur           7,114      487
                       P2 - 3m           15,811    1,558
                       P3 - ytd          64,961    6,345
                       P4 - 1y           20,867    2,342
01-Apr-2019 PROD_ONE   P1 - cur           3,542      797
                       P2 - 3m           16,428    1,516
                       P3 - ytd          72,884    7,031
                       P4 - 1y           25,349    2,888
            PROD_TWO   P1 - cur           2,376      789
                       P2 - 3m           13,381    1,539
                       P3 - ytd          64,961    6,345
                       P4 - 1y           23,243    3,131
01-May-2019 PROD_ONE   P1 - cur           8,366      769
                       P2 - 3m           18,236    2,170
                       P3 - ytd          72,884    7,031
                       P4 - 1y           33,715    3,657
            PROD_TWO   P1 - cur           9,486      138
                       P2 - 3m           18,976    1,414
                       P3 - ytd          64,961    6,345
                       P4 - 1y           32,729    3,269
01-Jun-2019 PROD_ONE   P1 - cur           5,225      139
                       P2 - 3m           17,133    1,705
                       P3 - ytd          72,884    7,031
                       P4 - 1y           38,940    3,796
            PROD_TWO   P1 - cur           6,982      522
                       P2 - 3m           18,844    1,449
                       P3 - ytd          64,961    6,345
                       P4 - 1y           39,711    3,791
01-Jul-2019 PROD_ONE   P1 - cur           8,574      677
                       P2 - 3m           22,165    1,585
                       P3 - ytd          72,884    7,031
                       P4 - 1y           47,514    4,473
            PROD_TWO   P1 - cur           3,594      718
                       P2 - 3m           20,062    1,378
                       P3 - ytd          64,961    6,345
                       P4 - 1y           43,305    4,509
01-Aug-2019 PROD_ONE   P1 - cur           4,441      615
                       P2 - 3m           18,240    1,431
                       P3 - ytd          72,884    7,031
                       P4 - 1y           51,955    5,088
            PROD_TWO   P1 - cur           9,636      262
                       P2 - 3m           20,212    1,502
                       P3 - ytd          64,961    6,345
                       P4 - 1y           52,941    4,771
01-Sep-2019 PROD_ONE   P1 - cur           7,075      845
                       P2 - 3m           20,090    2,137
                       P3 - ytd          72,884    7,031
                       P4 - 1y           59,030    5,933
            PROD_TWO   P1 - cur           6,085      386
                       P2 - 3m           19,315    1,366
                       P3 - ytd          64,961    6,345
                       P4 - 1y           59,026    5,157
01-Oct-2019 PROD_ONE   P1 - cur           7,993      245
                       P2 - 3m           19,509    1,705
                       P3 - ytd          72,884    7,031
                       P4 - 1y           67,023    6,178
            PROD_TWO   P1 - cur           4,576      967
                       P2 - 3m           20,297    1,615
                       P3 - ytd          64,961    6,345
                       P4 - 1y           63,602    6,124
01-Nov-2019 PROD_ONE   P1 - cur           8,046      674
                       P2 - 3m           23,114    1,764
                       P3 - ytd          72,884    7,031
                       P4 - 1y           75,069    6,852
            PROD_TWO   P1 - cur           3,750      162
                       P2 - 3m           14,411    1,515
                       P3 - ytd          64,961    6,345
                       P4 - 1y           67,352    6,286
01-Dec-2019 PROD_ONE   P1 - cur           2,713      882
                       P2 - 3m           18,752    1,801
                       P3 - ytd          72,884    7,031
                       P4 - 1y           72,884    7,031
            PROD_TWO   P1 - cur           2,665      843
                       P2 - 3m           10,991    1,972
                       P3 - ytd          64,961    6,345
                       P4 - 1y           64,961    6,345
01-Jan-2020 PROD_ONE   P1 - cur           3,848      154
                       P2 - 3m           14,607    1,710
                       P3 - ytd          59,336    5,763
                       P4 - 1y           72,709    6,516
            PROD_TWO   P1 - cur           3,837      289
                       P2 - 3m           10,252    1,294
                       P3 - ytd          60,325    7,066
                       P4 - 1y           63,992    5,826
01-Feb-2020 PROD_ONE   P1 - cur           9,555      145
                       P2 - 3m           16,116    1,181
                       P3 - ytd          59,336    5,763
                       P4 - 1y           75,706    6,546
            PROD_TWO   P1 - cur           7,662      924
                       P2 - 3m           14,164    2,056
                       P3 - ytd          60,325    7,066
                       P4 - 1y           67,763    6,487
01-Mar-2020 PROD_ONE   P1 - cur           6,832      698
                       P2 - 3m           20,235      997
                       P3 - ytd          59,336    5,763
                       P4 - 1y           76,210    6,640
            PROD_TWO   P1 - cur           4,697      721
                       P2 - 3m           16,196    1,934
                       P3 - ytd          60,325    7,066
                       P4 - 1y           65,346    6,721
01-Apr-2020 PROD_ONE   P1 - cur           2,328      376
                       P2 - 3m           18,715    1,219
                       P3 - ytd          59,336    5,763
                       P4 - 1y           74,996    6,219
            PROD_TWO   P1 - cur           1,402      885
                       P2 - 3m           13,761    2,530
                       P3 - ytd          60,325    7,066
                       P4 - 1y           64,372    6,817
01-May-2020 PROD_ONE   P1 - cur           5,390      997
                       P2 - 3m           14,550    2,071
                       P3 - ytd          59,336    5,763
                       P4 - 1y           72,020    6,447
            PROD_TWO   P1 - cur           7,024      472
                       P2 - 3m           13,123    2,078
                       P3 - ytd          60,325    7,066
                       P4 - 1y           61,910    7,151
01-Jun-2020 PROD_ONE   P1 - cur           3,260      242
                       P2 - 3m           10,978    1,615
                       P3 - ytd          59,336    5,763
                       P4 - 1y           70,055    6,550
            PROD_TWO   P1 - cur           8,165      550
                       P2 - 3m           16,591    1,907
                       P3 - ytd          60,325    7,066
                       P4 - 1y           63,093    7,179
01-Jul-2020 PROD_ONE   P1 - cur           7,648      888
                       P2 - 3m           16,298    2,127
                       P3 - ytd          59,336    5,763
                       P4 - 1y           69,129    6,761
            PROD_TWO   P1 - cur           1,479      722
                       P2 - 3m           16,668    1,744
                       P3 - ytd          60,325    7,066
                       P4 - 1y           60,978    7,183
01-Aug-2020 PROD_ONE   P1 - cur           9,884      891
                       P2 - 3m           20,792    2,021
                       P3 - ytd          59,336    5,763
                       P4 - 1y           74,572    7,037
            PROD_TWO   P1 - cur           4,764      671
                       P2 - 3m           14,408    1,943
                       P3 - ytd          60,325    7,066
                       P4 - 1y           56,106    7,592
01-Sep-2020 PROD_ONE   P1 - cur           1,766      635
                       P2 - 3m           19,298    2,414
                       P3 - ytd          59,336    5,763
                       P4 - 1y           69,263    6,827
            PROD_TWO   P1 - cur           6,494      758
                       P2 - 3m           12,737    2,151
                       P3 - ytd          60,325    7,066
                       P4 - 1y           56,515    7,964
01-Oct-2020 PROD_ONE   P1 - cur           1,085      244
                       P2 - 3m           12,735    1,770
                       P3 - ytd          59,336    5,763
                       P4 - 1y           62,355    6,826
            PROD_TWO   P1 - cur           7,382      562
                       P2 - 3m           18,640    1,991
                       P3 - ytd          60,325    7,066
                       P4 - 1y           59,321    7,559
01-Nov-2020 PROD_ONE   P1 - cur           4,585      137
                       P2 - 3m            7,436    1,016
                       P3 - ytd          59,336    5,763
                       P4 - 1y           58,894    6,289
            PROD_TWO   P1 - cur           2,048      137
                       P2 - 3m           15,924    1,457
                       P3 - ytd          60,325    7,066
                       P4 - 1y           57,619    7,534
01-Dec-2020 PROD_ONE   P1 - cur           3,155      356
                       P2 - 3m            8,825      737
                       P3 - ytd          59,336    5,763
                       P4 - 1y           59,336    5,763
            PROD_TWO   P1 - cur           5,371      375
                       P2 - 3m           14,801    1,074
                       P3 - ytd          60,325    7,066
                       P4 - 1y           60,325    7,066
01-Jan-2021 PROD_ONE   P1 - cur           5,044      895
                       P2 - 3m           12,784    1,388
                       P3 - ytd          50,810    6,489
                       P4 - 1y           60,532    6,504
            PROD_TWO   P1 - cur           1,341      638
                       P2 - 3m            8,760    1,150
                       P3 - ytd          58,332    5,541
                       P4 - 1y           57,829    7,415
01-Feb-2021 PROD_ONE   P1 - cur           1,825      653
                       P2 - 3m           10,024    1,904
                       P3 - ytd          50,810    6,489
                       P4 - 1y           52,802    7,012
            PROD_TWO   P1 - cur           5,896      840
                       P2 - 3m           12,608    1,853
                       P3 - ytd          58,332    5,541
                       P4 - 1y           56,063    7,331
01-Mar-2021 PROD_ONE   P1 - cur           8,391      661
                       P2 - 3m           15,260    2,209
                       P3 - ytd          50,810    6,489
                       P4 - 1y           54,361    6,975
            PROD_TWO   P1 - cur           4,948      672
                       P2 - 3m           12,185    2,150
                       P3 - ytd          58,332    5,541
                       P4 - 1y           56,314    7,282
01-Apr-2021 PROD_ONE   P1 - cur           5,849      687
                       P2 - 3m           16,065    2,001
                       P3 - ytd          50,810    6,489
                       P4 - 1y           57,882    7,286
            PROD_TWO   P1 - cur           6,268      764
                       P2 - 3m           17,112    2,276
                       P3 - ytd          58,332    5,541
                       P4 - 1y           61,180    7,161
01-May-2021 PROD_ONE   P1 - cur           7,226      611
                       P2 - 3m           21,466    1,959
                       P3 - ytd          50,810    6,489
                       P4 - 1y           59,718    6,900
            PROD_TWO   P1 - cur           9,963      155
                       P2 - 3m           21,179    1,591
                       P3 - ytd          58,332    5,541
                       P4 - 1y           64,119    6,844
01-Jun-2021 PROD_ONE   P1 - cur           1,596      316
                       P2 - 3m           14,671    1,614
                       P3 - ytd          50,810    6,489
                       P4 - 1y           58,054    6,974
            PROD_TWO   P1 - cur           1,868      181
                       P2 - 3m           18,099    1,100
                       P3 - ytd          58,332    5,541
                       P4 - 1y           57,822    6,475
01-Jul-2021 PROD_ONE   P1 - cur           3,027      487
                       P2 - 3m           11,849    1,414
                       P3 - ytd          50,810    6,489
                       P4 - 1y           53,433    6,573
            PROD_TWO   P1 - cur           2,079      278
                       P2 - 3m           13,910      614
                       P3 - ytd          58,332    5,541
                       P4 - 1y           58,422    6,031
01-Aug-2021 PROD_ONE   P1 - cur           1,739      376
                       P2 - 3m            6,362    1,179
                       P3 - ytd          50,810    6,489
                       P4 - 1y           45,288    6,058
            PROD_TWO   P1 - cur           6,743      651
                       P2 - 3m           10,690    1,110
                       P3 - ytd          58,332    5,541
                       P4 - 1y           60,401    6,011
01-Sep-2021 PROD_ONE   P1 - cur           7,660      748
                       P2 - 3m           12,426    1,611
                       P3 - ytd          50,810    6,489
                       P4 - 1y           51,182    6,171
            PROD_TWO   P1 - cur           5,097      515
                       P2 - 3m           13,919    1,444
                       P3 - ytd          58,332    5,541
                       P4 - 1y           59,004    5,768
01-Oct-2021 PROD_ONE   P1 - cur           2,801      622
                       P2 - 3m           12,200    1,746
                       P3 - ytd          50,810    6,489
                       P4 - 1y           52,898    6,549
            PROD_TWO   P1 - cur           9,727      407
                       P2 - 3m           21,567    1,573
                       P3 - ytd          58,332    5,541
                       P4 - 1y           61,349    5,613
01-Nov-2021 PROD_ONE   P1 - cur           5,652      433
                       P2 - 3m           16,113    1,803
                       P3 - ytd          50,810    6,489
                       P4 - 1y           53,965    6,845
            PROD_TWO   P1 - cur           4,402      440
                       P2 - 3m           19,226    1,362
                       P3 - ytd          58,332    5,541
                       P4 - 1y           63,703    5,916

288 rows selected.

  1  SELECT *
  2    FROM Period_Agg_Dynamic.Period_Aggs(p_period_tps_lis => L1_chr_arr('cur', '3m', 'ytd', '1y'),
  3                                        p_period_nos_lis => L1_num_arr( 0,     2,    11,    11))
  4*  ORDER BY 1, 2, 3
Report by Analytic Aggregation in SQL macro

Month       Product    Period             Value     Cost
----------- ---------- --------------- -------- --------
01-Dec-2018 PROD_ONE   P1 - cur           4,898      703
                       P2 - 3m            4,898      703
                       P3 - ytd           4,898      703
                       P4 - 1y            4,898      703
            PROD_TWO   P1 - cur           5,056      784
                       P2 - 3m            5,056      784
                       P3 - ytd           5,056      784
                       P4 - 1y            5,056      784
01-Jan-2019 PROD_ONE   P1 - cur           4,023      669
                       P2 - 3m            8,921    1,372
                       P3 - ytd          72,884    7,031
                       P4 - 1y            8,921    1,372
            PROD_TWO   P1 - cur           4,806      808
                       P2 - 3m            9,862    1,592
                       P3 - ytd          64,961    6,345
                       P4 - 1y            9,862    1,592
01-Feb-2019 PROD_ONE   P1 - cur           6,558      115
                       P2 - 3m           15,479    1,487
                       P3 - ytd          72,884    7,031
                       P4 - 1y           15,479    1,487
            PROD_TWO   P1 - cur           3,891      263
                       P2 - 3m           13,753    1,855
                       P3 - ytd          64,961    6,345
                       P4 - 1y           13,753    1,855
01-Mar-2019 PROD_ONE   P1 - cur           6,328      604
                       P2 - 3m           16,909    1,388
                       P3 - ytd          72,884    7,031
                       P4 - 1y           21,807    2,091
            PROD_TWO   P1 - cur           7,114      487
                       P2 - 3m           15,811    1,558
                       P3 - ytd          64,961    6,345
                       P4 - 1y           20,867    2,342
01-Apr-2019 PROD_ONE   P1 - cur           3,542      797
                       P2 - 3m           16,428    1,516
                       P3 - ytd          72,884    7,031
                       P4 - 1y           25,349    2,888
            PROD_TWO   P1 - cur           2,376      789
                       P2 - 3m           13,381    1,539
                       P3 - ytd          64,961    6,345
                       P4 - 1y           23,243    3,131
01-May-2019 PROD_ONE   P1 - cur           8,366      769
                       P2 - 3m           18,236    2,170
                       P3 - ytd          72,884    7,031
                       P4 - 1y           33,715    3,657
            PROD_TWO   P1 - cur           9,486      138
                       P2 - 3m           18,976    1,414
                       P3 - ytd          64,961    6,345
                       P4 - 1y           32,729    3,269
01-Jun-2019 PROD_ONE   P1 - cur           5,225      139
                       P2 - 3m           17,133    1,705
                       P3 - ytd          72,884    7,031
                       P4 - 1y           38,940    3,796
            PROD_TWO   P1 - cur           6,982      522
                       P2 - 3m           18,844    1,449
                       P3 - ytd          64,961    6,345
                       P4 - 1y           39,711    3,791
01-Jul-2019 PROD_ONE   P1 - cur           8,574      677
                       P2 - 3m           22,165    1,585
                       P3 - ytd          72,884    7,031
                       P4 - 1y           47,514    4,473
            PROD_TWO   P1 - cur           3,594      718
                       P2 - 3m           20,062    1,378
                       P3 - ytd          64,961    6,345
                       P4 - 1y           43,305    4,509
01-Aug-2019 PROD_ONE   P1 - cur           4,441      615
                       P2 - 3m           18,240    1,431
                       P3 - ytd          72,884    7,031
                       P4 - 1y           51,955    5,088
            PROD_TWO   P1 - cur           9,636      262
                       P2 - 3m           20,212    1,502
                       P3 - ytd          64,961    6,345
                       P4 - 1y           52,941    4,771
01-Sep-2019 PROD_ONE   P1 - cur           7,075      845
                       P2 - 3m           20,090    2,137
                       P3 - ytd          72,884    7,031
                       P4 - 1y           59,030    5,933
            PROD_TWO   P1 - cur           6,085      386
                       P2 - 3m           19,315    1,366
                       P3 - ytd          64,961    6,345
                       P4 - 1y           59,026    5,157
01-Oct-2019 PROD_ONE   P1 - cur           7,993      245
                       P2 - 3m           19,509    1,705
                       P3 - ytd          72,884    7,031
                       P4 - 1y           67,023    6,178
            PROD_TWO   P1 - cur           4,576      967
                       P2 - 3m           20,297    1,615
                       P3 - ytd          64,961    6,345
                       P4 - 1y           63,602    6,124
01-Nov-2019 PROD_ONE   P1 - cur           8,046      674
                       P2 - 3m           23,114    1,764
                       P3 - ytd          72,884    7,031
                       P4 - 1y           75,069    6,852
            PROD_TWO   P1 - cur           3,750      162
                       P2 - 3m           14,411    1,515
                       P3 - ytd          64,961    6,345
                       P4 - 1y           67,352    6,286
01-Dec-2019 PROD_ONE   P1 - cur           2,713      882
                       P2 - 3m           18,752    1,801
                       P3 - ytd          72,884    7,031
                       P4 - 1y           72,884    7,031
            PROD_TWO   P1 - cur           2,665      843
                       P2 - 3m           10,991    1,972
                       P3 - ytd          64,961    6,345
                       P4 - 1y           64,961    6,345
01-Jan-2020 PROD_ONE   P1 - cur           3,848      154
                       P2 - 3m           14,607    1,710
                       P3 - ytd          59,336    5,763
                       P4 - 1y           72,709    6,516
            PROD_TWO   P1 - cur           3,837      289
                       P2 - 3m           10,252    1,294
                       P3 - ytd          60,325    7,066
                       P4 - 1y           63,992    5,826
01-Feb-2020 PROD_ONE   P1 - cur           9,555      145
                       P2 - 3m           16,116    1,181
                       P3 - ytd          59,336    5,763
                       P4 - 1y           75,706    6,546
            PROD_TWO   P1 - cur           7,662      924
                       P2 - 3m           14,164    2,056
                       P3 - ytd          60,325    7,066
                       P4 - 1y           67,763    6,487
01-Mar-2020 PROD_ONE   P1 - cur           6,832      698
                       P2 - 3m           20,235      997
                       P3 - ytd          59,336    5,763
                       P4 - 1y           76,210    6,640
            PROD_TWO   P1 - cur           4,697      721
                       P2 - 3m           16,196    1,934
                       P3 - ytd          60,325    7,066
                       P4 - 1y           65,346    6,721
01-Apr-2020 PROD_ONE   P1 - cur           2,328      376
                       P2 - 3m           18,715    1,219
                       P3 - ytd          59,336    5,763
                       P4 - 1y           74,996    6,219
            PROD_TWO   P1 - cur           1,402      885
                       P2 - 3m           13,761    2,530
                       P3 - ytd          60,325    7,066
                       P4 - 1y           64,372    6,817
01-May-2020 PROD_ONE   P1 - cur           5,390      997
                       P2 - 3m           14,550    2,071
                       P3 - ytd          59,336    5,763
                       P4 - 1y           72,020    6,447
            PROD_TWO   P1 - cur           7,024      472
                       P2 - 3m           13,123    2,078
                       P3 - ytd          60,325    7,066
                       P4 - 1y           61,910    7,151
01-Jun-2020 PROD_ONE   P1 - cur           3,260      242
                       P2 - 3m           10,978    1,615
                       P3 - ytd          59,336    5,763
                       P4 - 1y           70,055    6,550
            PROD_TWO   P1 - cur           8,165      550
                       P2 - 3m           16,591    1,907
                       P3 - ytd          60,325    7,066
                       P4 - 1y           63,093    7,179
01-Jul-2020 PROD_ONE   P1 - cur           7,648      888
                       P2 - 3m           16,298    2,127
                       P3 - ytd          59,336    5,763
                       P4 - 1y           69,129    6,761
            PROD_TWO   P1 - cur           1,479      722
                       P2 - 3m           16,668    1,744
                       P3 - ytd          60,325    7,066
                       P4 - 1y           60,978    7,183
01-Aug-2020 PROD_ONE   P1 - cur           9,884      891
                       P2 - 3m           20,792    2,021
                       P3 - ytd          59,336    5,763
                       P4 - 1y           74,572    7,037
            PROD_TWO   P1 - cur           4,764      671
                       P2 - 3m           14,408    1,943
                       P3 - ytd          60,325    7,066
                       P4 - 1y           56,106    7,592
01-Sep-2020 PROD_ONE   P1 - cur           1,766      635
                       P2 - 3m           19,298    2,414
                       P3 - ytd          59,336    5,763
                       P4 - 1y           69,263    6,827
            PROD_TWO   P1 - cur           6,494      758
                       P2 - 3m           12,737    2,151
                       P3 - ytd          60,325    7,066
                       P4 - 1y           56,515    7,964
01-Oct-2020 PROD_ONE   P1 - cur           1,085      244
                       P2 - 3m           12,735    1,770
                       P3 - ytd          59,336    5,763
                       P4 - 1y           62,355    6,826
            PROD_TWO   P1 - cur           7,382      562
                       P2 - 3m           18,640    1,991
                       P3 - ytd          60,325    7,066
                       P4 - 1y           59,321    7,559
01-Nov-2020 PROD_ONE   P1 - cur           4,585      137
                       P2 - 3m            7,436    1,016
                       P3 - ytd          59,336    5,763
                       P4 - 1y           58,894    6,289
            PROD_TWO   P1 - cur           2,048      137
                       P2 - 3m           15,924    1,457
                       P3 - ytd          60,325    7,066
                       P4 - 1y           57,619    7,534
01-Dec-2020 PROD_ONE   P1 - cur           3,155      356
                       P2 - 3m            8,825      737
                       P3 - ytd          59,336    5,763
                       P4 - 1y           59,336    5,763
            PROD_TWO   P1 - cur           5,371      375
                       P2 - 3m           14,801    1,074
                       P3 - ytd          60,325    7,066
                       P4 - 1y           60,325    7,066
01-Jan-2021 PROD_ONE   P1 - cur           5,044      895
                       P2 - 3m           12,784    1,388
                       P3 - ytd          50,810    6,489
                       P4 - 1y           60,532    6,504
            PROD_TWO   P1 - cur           1,341      638
                       P2 - 3m            8,760    1,150
                       P3 - ytd          58,332    5,541
                       P4 - 1y           57,829    7,415
01-Feb-2021 PROD_ONE   P1 - cur           1,825      653
                       P2 - 3m           10,024    1,904
                       P3 - ytd          50,810    6,489
                       P4 - 1y           52,802    7,012
            PROD_TWO   P1 - cur           5,896      840
                       P2 - 3m           12,608    1,853
                       P3 - ytd          58,332    5,541
                       P4 - 1y           56,063    7,331
01-Mar-2021 PROD_ONE   P1 - cur           8,391      661
                       P2 - 3m           15,260    2,209
                       P3 - ytd          50,810    6,489
                       P4 - 1y           54,361    6,975
            PROD_TWO   P1 - cur           4,948      672
                       P2 - 3m           12,185    2,150
                       P3 - ytd          58,332    5,541
                       P4 - 1y           56,314    7,282
01-Apr-2021 PROD_ONE   P1 - cur           5,849      687
                       P2 - 3m           16,065    2,001
                       P3 - ytd          50,810    6,489
                       P4 - 1y           57,882    7,286
            PROD_TWO   P1 - cur           6,268      764
                       P2 - 3m           17,112    2,276
                       P3 - ytd          58,332    5,541
                       P4 - 1y           61,180    7,161
01-May-2021 PROD_ONE   P1 - cur           7,226      611
                       P2 - 3m           21,466    1,959
                       P3 - ytd          50,810    6,489
                       P4 - 1y           59,718    6,900
            PROD_TWO   P1 - cur           9,963      155
                       P2 - 3m           21,179    1,591
                       P3 - ytd          58,332    5,541
                       P4 - 1y           64,119    6,844
01-Jun-2021 PROD_ONE   P1 - cur           1,596      316
                       P2 - 3m           14,671    1,614
                       P3 - ytd          50,810    6,489
                       P4 - 1y           58,054    6,974
            PROD_TWO   P1 - cur           1,868      181
                       P2 - 3m           18,099    1,100
                       P3 - ytd          58,332    5,541
                       P4 - 1y           57,822    6,475
01-Jul-2021 PROD_ONE   P1 - cur           3,027      487
                       P2 - 3m           11,849    1,414
                       P3 - ytd          50,810    6,489
                       P4 - 1y           53,433    6,573
            PROD_TWO   P1 - cur           2,079      278
                       P2 - 3m           13,910      614
                       P3 - ytd          58,332    5,541
                       P4 - 1y           58,422    6,031
01-Aug-2021 PROD_ONE   P1 - cur           1,739      376
                       P2 - 3m            6,362    1,179
                       P3 - ytd          50,810    6,489
                       P4 - 1y           45,288    6,058
            PROD_TWO   P1 - cur           6,743      651
                       P2 - 3m           10,690    1,110
                       P3 - ytd          58,332    5,541
                       P4 - 1y           60,401    6,011
01-Sep-2021 PROD_ONE   P1 - cur           7,660      748
                       P2 - 3m           12,426    1,611
                       P3 - ytd          50,810    6,489
                       P4 - 1y           51,182    6,171
            PROD_TWO   P1 - cur           5,097      515
                       P2 - 3m           13,919    1,444
                       P3 - ytd          58,332    5,541
                       P4 - 1y           59,004    5,768
01-Oct-2021 PROD_ONE   P1 - cur           2,801      622
                       P2 - 3m           12,200    1,746
                       P3 - ytd          50,810    6,489
                       P4 - 1y           52,898    6,549
            PROD_TWO   P1 - cur           9,727      407
                       P2 - 3m           21,567    1,573
                       P3 - ytd          58,332    5,541
                       P4 - 1y           61,349    5,613
01-Nov-2021 PROD_ONE   P1 - cur           5,652      433
                       P2 - 3m           16,113    1,803
                       P3 - ytd          50,810    6,489
                       P4 - 1y           53,965    6,845
            PROD_TWO   P1 - cur           4,402      440
                       P2 - 3m           19,226    1,362
                       P3 - ytd          58,332    5,541
                       P4 - 1y           63,703    5,916

288 rows selected.

  1  SELECT /*+ gather_plan_statistics XPLAN_MAC */ *
  2    FROM Period_Agg_Dynamic.Period_Aggs_Macro(p_column_lis     => L1_chr_arr('sales_value', 'sales_cost'),
  3                                              p_period_tps_lis => L1_chr_arr('cur', '3m', 'ytd', '1y'),
  4                                              p_period_nos_lis => L1_num_arr( 0,     2,    11,    11))
  5*  ORDER BY 1, 2, 3
SQL_ID  fmmyx8nv21m9r, child number 0
-------------------------------------
SELECT /*+ gather_plan_statistics XPLAN_UGB */      month_dt,
prod_code, 'P1 - 1 Month' per_tp, sales_value, sales_cost   FROM
sales_history  UNION ALL SELECT drv.month_dt, drv.prod_code, 'P2 - 3
Months', Sum(msr.sales_value), Sum(msr.sales_cost)   FROM sales_history
drv   JOIN sales_history msr   ON msr.prod_code = drv.prod_code    AND
msr.month_dt BETWEEN Add_Months (drv.month_dt, -2) AND drv.month_dt
GROUP BY drv.prod_code, drv.month_dt  UNION ALL SELECT drv.month_dt,
drv.prod_code, 'P3 - YTD', Sum(msr.sales_value), Sum(msr.sales_cost)
FROM sales_history drv   JOIN sales_history msr   ON msr.prod_code =
drv.prod_code    AND msr.month_dt BETWEEN Trunc(drv.month_dt, 'YEAR')
AND drv.month_dt  GROUP BY drv.prod_code, drv.month_dt  UNION ALL
SELECT drv.month_dt, drv.prod_code, 'P4 - 1 Year',
Sum(msr.sales_value), Sum(msr.sales_cost)   FROM sales_history drv
JOIN sales_history msr   ON msr.prod_code = drv.prod_code    AND
msr.month_dt BETWEEN Add_Months (drv.month_dt, -11) AND drv.mo
Plan hash value: 3154844439
----------------------------------------------------------------------------------------------------------------------------
| Id  | Operation             | Name          | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
----------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT      |               |      1 |        |    288 |00:00:00.01 |      27 |       |       |          |
|   1 |  SORT ORDER BY        |               |      1 |    225 |    288 |00:00:00.01 |      27 | 36864 | 36864 |32768  (0)|
|   2 |   UNION-ALL           |               |      1 |        |    288 |00:00:00.01 |      27 |       |       |          |
|   3 |    TABLE ACCESS FULL  | SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       6 |       |       |          |
|   4 |    HASH GROUP BY      |               |      1 |     51 |     72 |00:00:00.01 |       7 |   988K|   988K|          |
|*  5 |     HASH JOIN         |               |      1 |     67 |    210 |00:00:00.01 |       7 |  1506K|  1506K|  930K (0)|
|   6 |      INDEX FULL SCAN  | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
|   7 |      TABLE ACCESS FULL| SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       6 |       |       |          |
|   8 |    HASH GROUP BY      |               |      1 |     51 |     72 |00:00:00.01 |       7 |   988K|   988K|          |
|*  9 |     HASH JOIN         |               |      1 |     67 |    446 |00:00:00.01 |       7 |  1506K|  1506K|  917K (0)|
|  10 |      INDEX FULL SCAN  | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
|  11 |      TABLE ACCESS FULL| SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       6 |       |       |          |
|  12 |    HASH GROUP BY      |               |      1 |     51 |     72 |00:00:00.01 |       7 |   988K|   988K|          |
|* 13 |     HASH JOIN         |               |      1 |     67 |    732 |00:00:00.01 |       7 |  1506K|  1506K|  939K (0)|
|  14 |      INDEX FULL SCAN  | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
|  15 |      TABLE ACCESS FULL| SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       6 |       |       |          |
----------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
5 - access("MSR"."PROD_CODE"="DRV"."PROD_CODE")
filter(("MSR"."MONTH_DT"<="DRV"."MONTH_DT" AND "MSR"."MONTH_DT">=ADD_MONTHS(INTERNAL_FUNCTION("DRV"."MONTH_DT
"),-2)))
9 - access("MSR"."PROD_CODE"="DRV"."PROD_CODE")
filter(("MSR"."MONTH_DT"<="DRV"."MONTH_DT" AND "MSR"."MONTH_DT">=TRUNC(INTERNAL_FUNCTION("DRV"."MONTH_DT"),'f
myear')))
13 - access("MSR"."PROD_CODE"="DRV"."PROD_CODE")
filter(("MSR"."MONTH_DT"<="DRV"."MONTH_DT" AND "MSR"."MONTH_DT">=ADD_MONTHS(INTERNAL_FUNCTION("DRV"."MONTH_DT
"),-11)))

PL/SQL procedure successfully completed.

SQL_ID  8czy4ss57y81p, child number 0
-------------------------------------
WITH period_aggs AS (   SELECT /*+ gather_plan_statistics XPLAN_AAG */
month_dt, prod_code, sales_value,        Sum(sales_value) OVER
(PARTITION BY prod_code ORDER BY month_dt                   RANGE
BETWEEN INTERVAL '2' MONTH PRECEDING AND CURRENT ROW)
sales_value_3m,        Sum(sales_value) OVER (PARTITION BY prod_code,
Trunc(month_dt, 'YEAR') ORDER BY month_dt                   RANGE
BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)
sales_value_ytd,        Sum(sales_value) OVER (PARTITION BY prod_code
ORDER BY month_dt                   RANGE BETWEEN INTERVAL '11' MONTH
PRECEDING AND CURRENT ROW)     sales_value_1y,        sales_cost,
Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY month_dt
RANGE BETWEEN INTERVAL '2' MONTH PRECEDING AND CURRENT ROW)
sales_cost_3m,        Sum(sales_cost) OVER (PARTITION BY prod_code,
Trunc(month_dt, 'YEAR') ORDER BY month_dt                   RANGE
BETWEEN INTERVAL '11' MONTH PRECEDING AND CURREN
Plan hash value: 1117112452
----------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                         | Name          | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
----------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                  |               |      1 |        |    288 |00:00:00.01 |       2 |       |       |          |
|   1 |  SORT ORDER BY                    |               |      1 |    288 |    288 |00:00:00.01 |       2 | 27648 | 27648 |24576  (0)|
|*  2 |   VIEW                            |               |      1 |    288 |    288 |00:00:00.01 |       2 |       |       |          |
|   3 |    UNPIVOT                        |               |      1 |        |    288 |00:00:00.01 |       2 |       |       |          |
|   4 |     VIEW                          |               |      1 |     72 |     72 |00:00:00.01 |       2 |       |       |          |
|   5 |      WINDOW SORT                  |               |      1 |     72 |     72 |00:00:00.01 |       2 | 13312 | 13312 |12288  (0)|
|   6 |       WINDOW BUFFER               |               |      1 |     72 |     72 |00:00:00.01 |       2 |  6144 |  6144 | 6144  (0)|
|   7 |        TABLE ACCESS BY INDEX ROWID| SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       2 |       |       |          |
|   8 |         INDEX FULL SCAN           | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
----------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
2 - filter(("unpivot_view_006"."SALES_VALUE" IS NOT NULL OR "unpivot_view_006"."SALES_COST" IS NOT NULL))

PL/SQL procedure successfully completed.

SQL_ID  9kqub6yj40v1p, child number 0
-------------------------------------
WITH period_list AS (   SELECT month_dt, prod_code, COLUMN_VALUE per_tp
FROM TABLE(SYS.ODCIVarchar2List(           'P1 - 1 Month',
'P2 - 3 Months',           'P3 - YTD',           'P4 - 1 Year')
)   CROSS JOIN (SELECT month_dt, prod_code FROM sales_history) ) SELECT
/*+ gather_plan_statistics XPLAN_GBC */        drv.month_dt,
drv.prod_code, drv.per_tp,        Sum( CASE WHEN ( per_tp = 'P1 - 1
Month'  AND msr.month_dt = drv.month_dt ) OR                       (
per_tp = 'P2 - 3 Months' AND msr.month_dt >= Add_Months (drv.month_dt,
-2) ) OR                       ( per_tp = 'P3 - YTD'      AND Trunc
(msr.month_dt, 'YEAR') = Trunc (drv.month_dt, 'YEAR') ) OR
( per_tp = 'P4 - 1 Year'   AND msr.month_dt >= Add_Months
(drv.month_dt, -11) )                  THEN msr.sales_value END)
sales_value,        Sum( CASE WHEN ( per_tp = 'P1 - 1 Month'  AND
msr.month_dt = drv.month_dt ) OR                       ( per_tp = 'P2 -
3 Months' AND msr.month_dt >= Add_
Plan hash value: 1337298906
------------------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                                 | Name          | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
------------------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                          |               |      1 |        |    288 |00:00:00.01 |       7 |       |       |          |
|   1 |  SORT GROUP BY                            |               |      1 |     51 |    288 |00:00:00.01 |       7 | 40960 | 40960 |36864  (0)|
|*  2 |   HASH JOIN                               |               |      1 |     10M|   5328 |00:00:00.01 |       7 |  1476K|  1476K|  933K (0)|
|   3 |    INDEX FULL SCAN                        | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
|   4 |    MERGE JOIN CARTESIAN                   |               |      1 |    588K|    288 |00:00:00.01 |       6 |       |       |          |
|   5 |     TABLE ACCESS FULL                     | SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       6 |       |       |          |
|   6 |     BUFFER SORT                           |               |     72 |   8168 |    288 |00:00:00.01 |       0 |  2048 |  2048 | 2048  (0)|
|   7 |      COLLECTION ITERATOR CONSTRUCTOR FETCH|               |      1 |   8168 |      4 |00:00:00.01 |       0 |       |       |          |
------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
2 - access("MSR"."PROD_CODE"="PROD_CODE")
filter("MSR"."MONTH_DT"<="MONTH_DT")

PL/SQL procedure successfully completed.

SQL_ID  fpgrgpqm48wvx, child number 0
-------------------------------------
WITH period_aggs AS (SELECT /*+ gather_plan_statistics XPLAN_PLF */
month_dt, prod_code, sales_value, Sum(sales_value) OVER (PARTITION BY
prod_code ORDER BY  month_dt RANGE BETWEEN INTERVAL '2' MONTH PRECEDING
AND CURRENT ROW) sales_value_3m, Sum(sales_value) OVER (PARTITION BY
prod_code ORDER BY Trunc(month_dt, 'YEAR') RANGE BETWEEN INTERVAL '11'
MONTH PRECEDING AND CURRENT ROW) sales_value_ytd, Sum(sales_value) OVER
(PARTITION BY prod_code ORDER BY  month_dt RANGE BETWEEN INTERVAL '11'
MONTH PRECEDING AND CURRENT ROW) sales_value_1y, sales_cost,
Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY  month_dt RANGE
BETWEEN INTERVAL '2' MONTH PRECEDING AND CURRENT ROW) sales_cost_3m,
Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY Trunc(month_dt,
'YEAR') RANGE BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)
sales_cost_ytd, Sum(sales_cost) OVER (PARTITION BY prod_code ORDER BY
month_dt RANGE BETWEEN INTERVAL '11' MONTH PRECEDING AND CURRENT ROW)
sales_cost_1y FROM sales_h
Plan hash value: 2203348307
---------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                        | Name          | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
---------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                 |               |      1 |        |    288 |00:00:00.01 |       2 |       |       |          |
|*  1 |  VIEW                            |               |      1 |    288 |    288 |00:00:00.01 |       2 |       |       |          |
|   2 |   UNPIVOT                        |               |      1 |        |    288 |00:00:00.01 |       2 |       |       |          |
|   3 |    VIEW                          |               |      1 |     72 |     72 |00:00:00.01 |       2 |       |       |          |
|   4 |     WINDOW SORT                  |               |      1 |     72 |     72 |00:00:00.01 |       2 | 13312 | 13312 |12288  (0)|
|   5 |      WINDOW BUFFER               |               |      1 |     72 |     72 |00:00:00.01 |       2 |  6144 |  6144 | 6144  (0)|
|   6 |       TABLE ACCESS BY INDEX ROWID| SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       2 |       |       |          |
|   7 |        INDEX FULL SCAN           | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
---------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
1 - filter(("unpivot_view_006"."SALES_VALUE" IS NOT NULL OR "unpivot_view_006"."SALES_COST" IS NOT NULL))

PL/SQL procedure successfully completed.

SQL_ID  4hrgm0ub2mbvz, child number 0
-------------------------------------
SELECT /*+ gather_plan_statistics XPLAN_MAC */ *   FROM
Period_Agg_Dynamic.Period_Aggs_Macro(p_column_lis     =>
L1_chr_arr('sales_value', 'sales_cost'),
p_period_tps_lis => L1_chr_arr('cur', '3m', 'ytd', '1y'),
p_period_nos_lis =>
L1_num_arr( 0,     2,    11,    11))  ORDER BY 1, 2, 3
Plan hash value: 1117112452
----------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                         | Name          | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
----------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                  |               |      1 |        |    288 |00:00:00.01 |       2 |       |       |          |
|   1 |  SORT ORDER BY                    |               |      1 |    288 |    288 |00:00:00.01 |       2 | 33792 | 33792 |30720  (0)|
|*  2 |   VIEW                            |               |      1 |    288 |    288 |00:00:00.01 |       2 |       |       |          |
|   3 |    UNPIVOT                        |               |      1 |        |    288 |00:00:00.01 |       2 |       |       |          |
|   4 |     VIEW                          |               |      1 |     72 |     72 |00:00:00.01 |       2 |       |       |          |
|   5 |      WINDOW SORT                  |               |      1 |     72 |     72 |00:00:00.01 |       2 | 13312 | 13312 |12288  (0)|
|   6 |       WINDOW BUFFER               |               |      1 |     72 |     72 |00:00:00.01 |       2 |  6144 |  6144 | 6144  (0)|
|   7 |        TABLE ACCESS BY INDEX ROWID| SALES_HISTORY |      1 |     72 |     72 |00:00:00.01 |       2 |       |       |          |
|   8 |         INDEX FULL SCAN           | SLH_PK        |      1 |     72 |     72 |00:00:00.01 |       1 |       |       |          |
----------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
2 - filter(("unpivot_view_010"."SALES_VALUE" IS NOT NULL OR "unpivot_view_010"."SALES_COST" IS NOT NULL))

PL/SQL procedure successfully completed.


'END:'||TO_CHAR(SYSDATE,'DD-MON-YY
----------------------------------
End: 09-NOV-2021 07:47:43

